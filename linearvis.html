<!DOCTYPE html>
<meta charset="utf-8">
<title>Zoom + Pan</title>
<style>

svg {
  shape-rendering: crispEdges;
}


.axis path, .axis line {
  fill: none;
  stroke: #fff;
}

div.tooltip {   
  position: absolute;           
  text-align: center;           
  width: 100px;                  
  height: 30px;                 
  padding: 2px;             
  font: 12px sans-serif;        
  background: lightsteelblue;   
  border: 0px;      
  border-radius: 8px;           
  pointer-events: none;         
}

</style>
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script> 
<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
<script>    
    function loadLightBox(fileName) {
        req=new XMLHttpRequest();
        req.onreadystatechange=function() {
            if (req.readyState==4 && req.status==200) {
                var input_data = req.responseText;
                var seq = "";
                dataset = [];
                array_input  = input_data.split("\n");

                info_txt = array_input[0];
                var div = d3.select("body").append("div")   
                    .attr("class", "tooltip")               
                    .style("opacity", 0);
                start_index = parseInt(info_txt.substring(info_txt.indexOf(':')+1, info_txt.indexOf('-'))); 
                for (var i = 1; i < array_input.length; i++ ){
                    seq += array_input[i];
                }
                for (var i=0;i<seq.length; i++){
                    dataset[i] = seq.charAt(i);
                }

                var margin = {top: 20, right: 20, bottom: 30, left: 20},
                width = 660 - margin.left - margin.right,
                height = 80 - margin.top - margin.bottom;

                var x = d3.scale.linear()
                .domain([0, seq.length])
                .range([0, width]);

                var y = d3.scale.linear()
                .domain([height, 0])
                .range([height, 0]);

                var zoom = d3.behavior.zoom()
                .x(x)
                .scaleExtent([1,25])
                .on("zoom", zoomed);

                var linear_svg = d3.select("body").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
                .call(zoom);

                var bar1 = linear_svg.selectAll('.bar').data(dataset)
                .enter()
                .append("g")
                .attr("transform", function(datum, index){
                    return "translate(" + x(index) + "," + 20 + ")"
                })
                .attr("class","bar")
                .each(function(datum, index){
                    var g = d3.select(this);
                    var width = (x(1) - x(0));

                    g.append("rect")
                    .attr("width",width)
                    .attr("height", "20px")
                    .style("fill",function(d){
                        if (d == "A")
                            return "#0000FF";
                        else if (d == "G")
                            return "#00FF00";
                        else if (d=="T")
                            return "#FFFF00";
                        else
                            return "#FF0000"; 
                    })
                    .style("stroke",function(d){
                            return "black";
                    })
                    .style("stroke-width",function(d){
                            return width/9;
                    })
                    .on("mouseover", function(d) {
                        var desc = "";
                        if (d == "A")
                            desc = "Adenine";
                        else if (d == "G")
                            desc = "Guanine";
                        else if (d=="T")
                            desc = "Thiamine";
                        else
                            desc = "Cytosine";
                        div.transition()        
                        .duration(200)      
                        .style("opacity", .9);      
                        div .html("<strong> "+desc+"<BR>Position : "+(start_index + index)+"</strong>")
                        .style("left", (d3.event.pageX) + "px")     
                        .style("top", (5) + "px");    
                    })
                    .on("mouseout", function(d) {
                        div.transition()        
                        .duration(200)      
                        .style("opacity", 0);
                    });
                    if((x(1) - x(0)) > 9){
                        g.append("text")
                        .attr("text-anchor","middle")
                        .attr("y", "13")
                        .attr("x", width/2)
                        .attr("font-size", "8")
                        .attr("fill", "black")
                        .text(datum);
                    }
                });

                function zoomed() {
                    linear_svg.selectAll('.bar').remove();
                    var multiplier = 10;
                    var width = (x(1) - x(0));
                    

                    var bar1 = linear_svg.selectAll('.bar').data(dataset)
                        .enter()
                        .append("g")
                        .attr("transform", function(datum, index){
                            return "translate(" + x(index) + "," + 20 + ")"
                        })
                        .attr("width", width)
                        .attr("class","bar")
                        .each(function(datum, index){
                            var g = d3.select(this);
                            g.append("rect")
                            .attr("width",width)
                            .attr("height", "20px")
                            .style("fill",function(d){
                                if (d == "A")
                                    return "#0000FF";
                                else if (d == "G")
                                    return "#00FF00";
                                else if (d=="T")
                                    return "#FFFF00";
                                else
                                    return "#FF0000";
                            })
                            .style("stroke",function(d){
                                    return "black";
                            })
                            .style("stroke-width",function(d){
                                    return width/9;
                            })
                            .on("mouseover", function(d) {
                                var desc = "";
                                if (d == "A")
                                    desc = "Adenine";
                                else if (d == "G")
                                    desc = "Guanine";
                                else if (d=="T")
                                    desc = "Thiamine";
                                else
                                    desc = "Cytosine";
                                div.transition()        
                                .duration(200)      
                                .style("opacity", .9);      
                                div .html("<strong> "+desc+"<BR>Position : "+(start_index + index)+"</strong>")
                                .style("left", (d3.event.pageX) + "px")     
                                .style("top", (5) + "px");    
                            })
                            .on("mouseout", function(d) {
                                div.transition()        
                                .duration(200)      
                                .style("opacity", 0);
                            });

                            if(width > 9){
                                g.append("text")
                                .attr("text-anchor","middle")
                                .attr("y", "13")
                                .attr("x", width/2)
                                .attr("font-size", "8")
                                .attr("fill", "black")
                                .text(datum);
                            }

                        });
                }

            }
        }
        req.open("GET",fileName,true);
        req.send();
    }
    var in_file = "BlacktipReefShark_ATP6.fa";
    var full_file_path = "data\/"+in_file.replace("_","\/");
    console.log(full_file_path);
    loadLightBox(full_file_path);
</script>